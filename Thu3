-- Jump Cao + Đổi Server (All-in-one)
-- Dán vào StarterPlayer > StarterPlayerScripts

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "JumpServerGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Name = "Panel"
frame.AnchorPoint = Vector2.new(1,0)
frame.Position = UDim2.new(1, -20, 0, 20)
frame.Size = UDim2.new(0, 220, 0, 130)
frame.BackgroundTransparency = 0.15
frame.Parent = gui

-- Cho phép kéo bảng
do
	local dragging, dragStart, startPos
	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
		end
	end)
	frame.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

local function makeButton(text, y)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -20, 0, 36)
	btn.Position = UDim2.new(0, 10, 0, y)
	btn.Text = text
	btn.AutoButtonColor = true
	btn.Parent = frame
	return btn
end

-- Trạng thái
local jumpBoostOn = false

local btnJump = makeButton("Nhảy cao: OFF", 8)
local btnServer = makeButton("Đổi server", 46)

-- ===== Nhảy cao =====
btnJump.MouseButton1Click:Connect(function()
	jumpBoostOn = not jumpBoostOn
	btnJump.Text = jumpBoostOn and "Nhảy cao: ON" or "Nhảy cao: OFF"
	local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
	if hum then
		hum.UseJumpPower = true
		hum.JumpPower = jumpBoostOn and 150 or 50 -- mặc định 50, bật lên 150
	end
end)

-- ===== Đổi server =====
local function teleportToAnotherServer()
	local gameId = game.PlaceId
	local servers = {}
	local cursor

	-- Lấy danh sách server public
	local success, result = pcall(function()
		return HttpService:JSONDecode(game:HttpGet(
			"https://games.roblox.com/v1/games/"..gameId.."/servers/Public?sortOrder=Asc&limit=100"..(cursor and "&cursor="..cursor or "")
		))
	end)

	if success and result and result.data then
		for _, srv in ipairs(result.data) do
			if srv.playing < srv.maxPlayers and srv.id ~= game.JobId then
				table.insert(servers, srv.id)
			end
		end
	end

	if #servers > 0 then
		local randomServer = servers[math.random(1, #servers)]
		TeleportService:TeleportToPlaceInstance(gameId, randomServer, player)
	else
		-- Nếu không có server nào khác thì rejoin lại server hiện tại
		TeleportService:Teleport(gameId, player)
	end
end

btnServer.MouseButton1Click:Connect(function()
	teleportToAnotherServer()
end)

-- Giữ trạng thái khi respawn
player.CharacterAdded:Connect(function(char)
	if jumpBoostOn then
		local hum = char:WaitForChild("Humanoid")
		hum.UseJumpPower = true
		hum.JumpPower = 150
	end
end)
