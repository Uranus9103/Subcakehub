-- FULL SCRIPT: Shield + Music + Halo + Fire
-- ƒê·∫∑t trong StarterPlayerScripts (LocalScript)

-- SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()

-- Remote cho Shield
local remote = ReplicatedStorage:FindFirstChild("ShieldToggleEvent")
if not remote then
    remote = Instance.new("RemoteEvent")
    remote.Name = "ShieldToggleEvent"
    remote.Parent = ReplicatedStorage
end

-- ======================================
-- GUI SETUP
-- ======================================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PowerMenu"
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 180, 0, 250)
mainFrame.Position = UDim2.new(1, -200, 0, 50) -- g√≥c ph·∫£i tr√™n
mainFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
mainFrame.BackgroundTransparency = 0.2
mainFrame.Parent = screenGui

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0,5)
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout.Parent = mainFrame

local function createButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,160,0,40)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 20
    btn.Parent = mainFrame
    return btn
end

-- ======================================
-- N√öT 1: SHIELD
-- ======================================
local shieldBtn = createButton("B·∫≠t L√° Ch·∫Øn")
local shieldActive = false
local orbitParts = {}
local numParts, radius, rotationSpeed, checkRadius = 6, 5, 2, 4

local function createShieldParts()
    local parts = {}
    for i = 1, numParts do
        local part = Instance.new("Part")
        part.Size = Vector3.new(1.5,1.5,1.5)
        part.Shape = Enum.PartType.Ball
        part.Anchored = true
        part.CanCollide = false
        part.Material = Enum.Material.Neon
        part.Color = Color3.fromRGB(255, 215, 0) -- v√†ng
        part.Transparency = 0.2
        part.Parent = workspace
        table.insert(parts, part)
    end
    return parts
end

shieldBtn.MouseButton1Click:Connect(function()
    shieldActive = not shieldActive
    shieldBtn.Text = shieldActive and "T·∫Øt L√° Ch·∫Øn" or "B·∫≠t L√° Ch·∫Øn"
    remote:FireServer(shieldActive)

    if shieldActive then
        orbitParts = createShieldParts()
    else
        for _, p in pairs(orbitParts) do p:Destroy() end
        orbitParts = {}
    end
end)

RunService.RenderStepped:Connect(function()
    if not shieldActive then return end
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local time = tick() * rotationSpeed
    for i, part in ipairs(orbitParts) do
        local angle = time + (i * (2*math.pi/numParts))
        local x = hrp.Position.X + radius * math.cos(angle)
        local z = hrp.Position.Z + radius * math.sin(angle)
        part.Position = Vector3.new(x, hrp.Position.Y + 2, z)
    end
end)

-- SERVER DAMAGE
remote.OnServerEvent:Connect(function(plr, state)
    if state then
        local conn
        conn = RunService.Heartbeat:Connect(function()
            if not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
                conn:Disconnect()
                return
            end
            local hrp = plr.Character.HumanoidRootPart
            local time = tick() * rotationSpeed
            for i = 1, numParts do
                local angle = time + (i * (2*math.pi/numParts))
                local x = hrp.Position.X + radius * math.cos(angle)
                local z = hrp.Position.Z + radius * math.sin(angle)
                local partPos = Vector3.new(x, hrp.Position.Y + 2, z)

                for _, other in pairs(Players:GetPlayers()) do
                    if other ~= plr and other.Character then
                        local hum = other.Character:FindFirstChild("Humanoid")
                        local ohrp = other.Character:FindFirstChild("HumanoidRootPart")
                        if hum and ohrp then
                            if (ohrp.Position - partPos).Magnitude < checkRadius then
                                hum.Health = 0
                            end
                        end
                    end
                end
            end
        end)
        plr:SetAttribute("ShieldConnection", conn)
    else
        local conn = plr:GetAttribute("ShieldConnection")
        if conn then conn:Disconnect() end
        plr:SetAttribute("ShieldConnection", nil)
    end
end)

-- ======================================
-- N√öT 2: MUSIC
-- ======================================
local musicBox = Instance.new("TextBox")
musicBox.Size = UDim2.new(0,160,0,30)
musicBox.PlaceholderText = "Nh·∫≠p ID Nh·∫°c..."
musicBox.Text = ""
musicBox.Parent = mainFrame

local musicBtn = createButton("Ph√°t Nh·∫°c")
local sound = nil

musicBtn.MouseButton1Click:Connect(function()
    if sound then sound:Destroy() sound = nil end
    local id = musicBox.Text
    if id ~= "" then
        -- t·∫Øt nh·∫°c g·ªëc game
        for _, s in pairs(workspace:GetDescendants()) do
            if s:IsA("Sound") and s.Playing then
                s.Playing = false
            end
        end
        -- ph√°t nh·∫°c m·ªõi
        sound = Instance.new("Sound")
        sound.SoundId = "rbxassetid://"..id
        sound.Looped = true
        sound.Volume = 2
        sound.Parent = workspace
        sound:Play()
    end
end)

-- ======================================
-- N√öT 3: HALO (v√≤ng donut)
-- ======================================
local haloBtn = createButton("B·∫≠t H√†o Quang")
local haloActive = false
local haloPart = nil

haloBtn.MouseButton1Click:Connect(function()
    haloActive = not haloActive
    haloBtn.Text = haloActive and "T·∫Øt H√†o Quang" or "B·∫≠t H√†o Quang"

    if haloActive then
        haloPart = Instance.new("Part")
        haloPart.Size = Vector3.new(5,1,5)
        haloPart.Anchored = false
        haloPart.CanCollide = false
        haloPart.Transparency = 0.3
        haloPart.Material = Enum.Material.Neon
        haloPart.Color = Color3.fromRGB(255, 223, 0) -- v√†ng s√°ng
        haloPart.Parent = workspace

        local mesh = Instance.new("SpecialMesh")
        mesh.MeshType = Enum.MeshType.Torus
        mesh.Scale = Vector3.new(3,0.5,3)
        mesh.Parent = haloPart

        local hrp = player.Character:WaitForChild("HumanoidRootPart")
        local weld = Instance.new("WeldConstraint")
        weld.Part0 = hrp
        weld.Part1 = haloPart
        weld.Parent = haloPart

        haloPart.CFrame = hrp.CFrame * CFrame.new(0,0,-3)

        RunService.RenderStepped:Connect(function()
            if haloActive and haloPart then
                haloPart.CFrame = haloPart.CFrame * CFrame.Angles(0, math.rad(2), 0)
            end
        end)
    else
        if haloPart then
            haloPart:Destroy()
            haloPart = nil
        end
    end
end)

-- ======================================
-- N√öT 4: FIRE üî•
-- ======================================
local fireBtn = createButton("B·∫≠t L·ª≠a üî•")
local fireActive = false
local fireEffect = nil

fireBtn.MouseButton1Click:Connect(function()
    fireActive = not fireActive
    fireBtn.Text = fireActive and "T·∫Øt L·ª≠a üî•" or "B·∫≠t L·ª≠a üî•"

    local hrp = player.Character:WaitForChild("HumanoidRootPart")
    if fireActive then
        fireEffect = Instance.new("Fire")
        fireEffect.Size = 10
        fireEffect.Heat = 15
        fireEffect.Color = Color3.fromRGB(255, 140, 0)
        fireEffect.SecondaryColor = Color3.fromRGB(255, 220, 100)
        fireEffect.Parent = hrp
    else
        if fireEffect then fireEffect:Destroy() fireEffect = nil end
    end
end)
