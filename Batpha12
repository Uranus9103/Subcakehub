--// D·ªãch v·ª•
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local plotsFolder = Workspace:WaitForChild("Plots")

--// Bi·∫øn tr·∫°ng th√°i
local scriptEnabled = false

--// Giao di·ªán n√∫t b·∫≠t/t·∫Øt
local gui = Instance.new("ScreenGui")
gui.Name = "BaseLockGui"
gui.ResetOnSpawn = false
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,160,0,50)
toggleButton.Position = UDim2.new(1,-170,1,-60) -- g√≥c ph·∫£i d∆∞·ªõi
toggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
toggleButton.TextColor3 = Color3.fromRGB(0,255,128)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 18
toggleButton.Text = "üîí Base Lock: OFF"
toggleButton.Parent = gui

--// H√†m t√¨m base c·ªßa ch√≠nh m√¨nh
local function getMyBase()
	for _, plot in ipairs(plotsFolder:GetChildren()) do
		if plot:FindFirstChild("PlotSign") then
			local yourBase = plot.PlotSign:FindFirstChild("YourBase")
			if yourBase and yourBase:FindFirstChild("TextLabel") then
				if yourBase.TextLabel.Text == LocalPlayer.Name then
					return plot
				end
			end
		end
	end
	return nil
end

--// H√†m reset base (kh√≥a l·∫°i, gi·ªØ b·∫£ng SurfaceGui)
local function resetBase(plot)
	local yourBase = plot:FindFirstChild("PlotSign"):FindFirstChild("YourBase")
	if yourBase and yourBase:FindFirstChild("TextLabel") then
		yourBase.TextLabel.Text = "Locked" -- ƒë·ªÉ l·∫°i b·∫£ng, ch·ªâ ƒë·ªïi ch·ªØ
	end
end

--// Toggle n√∫t
toggleButton.MouseButton1Click:Connect(function()
	scriptEnabled = not scriptEnabled
	if scriptEnabled then
		toggleButton.Text = "üîì Base Lock: ON"
		toggleButton.BackgroundColor3 = Color3.fromRGB(0,100,0)
	else
		toggleButton.Text = "üîí Base Lock: OFF"
		toggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
	end
end)

--// V√≤ng l·∫∑p ch√≠nh
task.spawn(function()
	while task.wait(1) do
		if scriptEnabled then
			local myBase = getMyBase()
			if myBase then
				-- Ki·ªÉm tra th·ªùi gian c√≤n l·∫°i
				local remainTime
				for _, part in ipairs(myBase:GetDescendants()) do
					if part:IsA("TextLabel") and part.Name == "RemainingTime" then
						remainTime = tonumber(part.Text:gsub("s",""))
						break
					end
				end
				
				-- Khi h·∫øt gi·ªù
				if remainTime and remainTime <= 0 then
					local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
					local spawnPart = myBase:FindFirstChild("Main") or myBase:FindFirstChild("Base") or myBase:FindFirstChildWhichIsA("BasePart")
					if root and spawnPart then
						root.CFrame = spawnPart.CFrame + Vector3.new(0,5,0) -- Teleport v·ªÅ base
					end
					
					-- Reset base (ch·ªâ ƒë·ªïi ch·ªØ, b·∫£ng SurfaceGui v·∫´n c√≤n)
					resetBase(myBase)
				end
			end
		end
	end
end)
