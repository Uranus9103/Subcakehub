-- LocalScript trong StarterPlayerScripts ho·∫∑c StarterGui

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlyBackSystem"
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0, 150, 0, 50)
saveBtn.Position = UDim2.new(0, 50, 1, -120)
saveBtn.Text = "üìç L∆∞u v·ªã tr√≠"
saveBtn.Parent = ScreenGui

local flyBtn = Instance.new("TextButton")
flyBtn.Size = UDim2.new(0, 150, 0, 50)
flyBtn.Position = UDim2.new(0, 220, 1, -120)
flyBtn.Text = "‚úàÔ∏è Bay v·ªÅ"
flyBtn.Parent = ScreenGui

-- Bi·∫øn
local savedCFrame
local flying = false
local tween

-- Khi nh√¢n v·∫≠t respawn
local function onCharacterAdded(char)
    character = char
    hrp = character:WaitForChild("HumanoidRootPart")
    humanoid = character:WaitForChild("Humanoid")

    -- Anti ch·∫øt: m√°u lu√¥n full
    humanoid:GetPropertyChangedSignal("Health"):Connect(function()
        if humanoid.Health < humanoid.MaxHealth then
            humanoid.Health = humanoid.MaxHealth
        end
    end)
end

player.CharacterAdded:Connect(onCharacterAdded)

-- L∆∞u v·ªã tr√≠
saveBtn.MouseButton1Click:Connect(function()
    if hrp then
        savedCFrame = hrp.CFrame
        print("‚úÖ ƒê√£ l∆∞u v·ªã tr√≠:", savedCFrame.Position)
    end
end)

-- H√†m bay m∆∞·ª£t b·∫±ng Tween
local function flyTo(targetCFrame)
    if not hrp or not targetCFrame then return end
    flying = true

    local distance = (targetCFrame.Position - hrp.Position).Magnitude
    local flyTime = math.clamp(distance / 80, 0.5, 8) -- xa nhanh, g·∫ßn ch·∫≠m

    if tween then tween:Cancel() end

    local tweenInfo = TweenInfo.new(flyTime, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    tween = TweenService:Create(hrp, tweenInfo, {CFrame = targetCFrame})
    tween:Play()

    tween.Completed:Connect(function()
        flying = false
        hrp.CFrame = targetCFrame -- ƒë·ª©ng ch√≠nh x√°c t·∫°i ch·ªó l∆∞u
    end)
end

-- N√∫t bay
flyBtn.MouseButton1Click:Connect(function()
    if savedCFrame then
        flyTo(savedCFrame)
    else
        warn("‚ö†Ô∏è Ch∆∞a l∆∞u v·ªã tr√≠!")
    end
end)

-- Anti reset v·ªÅ spawn (ch·ªâ khi ƒëang bay)
RunService.Stepped:Connect(function()
    if flying and savedCFrame and hrp then
        local distanceFromSaved = (hrp.Position - savedCFrame.Position).Magnitude
        if distanceFromSaved > 120 then
            print("üö´ Anti Reset k√≠ch ho·∫°t ‚Üí tr·∫£ v·ªÅ v·ªã tr√≠ ƒë√£ l∆∞u!")
            hrp.CFrame = savedCFrame
        end
    end
end)

-- Kh·ªüi ƒë·ªông anti l·∫ßn ƒë·∫ßu
onCharacterAdded(character)
