-- APEX HUB FINAL (Single LocalScript)
-- D√πng l√†m LocalScript trong PlayerGui / StarterPlayerScripts
-- Ch√∫ √Ω: Attribute "APEXIndex" tr√™n Player l∆∞u progress (kh√¥ng m·∫•t khi reset)
-- N∆°i ch·ªânh t·ªëc ƒë·ªô: liftSpeed, flySpeed, flyAmp ngay b√™n d∆∞·ªõi.

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- =========================
-- // CONFIG (ch·ªânh ·ªü ƒë√¢y)
-- =========================
local KEYS = {
	"APEXKEY1","APEXKEY2","APEXKEY3","APEXKEY4","APEXKEY5","APEXKEY6",
	"APEXKEY7","APEXKEY8","APEXKEY9","APEXKEY10","APEXKEY11","APEXKEY12"
}
local LINKS = {
	"https://link1.com","https://link2.com","https://link3.com","https://link4.com","https://link5.com","https://link6.com",
	"https://link7.com","https://link8.com","https://link9.com","https://link10.com","https://link11.com","https://link12.com"
}

-- Speed settings (ch·ªânh ·ªü ƒë√¢y)
local liftSpeed = 6        -- t·ªëc ƒë·ªô n√¢ng (ƒë∆°n v·ªã: studs/gi√¢y)
local flySpeed = 0.6       -- t·ªëc ƒë·ªô thay ƒë·ªïi (l·ªõn => nhanh h∆°n)
local flyAmp = 1.2         -- bi√™n ƒë·ªô l√™n/xu·ªëng (ch·ªânh cho ch·∫≠m/nh·ªè)

-- Gi·ªØ mapping an to√†n
local MAX_INDEX = #KEYS

-- =========================
-- // Helper: draggable (mouse + touch)
-- =========================
local function makeDraggable(frame)
	frame.Active = true
	frame.Selectable = true

	local dragging, dragInput, dragStart, startPos

	local function onInputBegan(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1
		   or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end

	local function onInputChanged(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement
		   or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end

	frame.InputBegan:Connect(onInputBegan)
	frame.InputChanged:Connect(onInputChanged)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging and dragStart and startPos then
			local delta = input.Position - dragStart
			local x = startPos.X.Offset + delta.X
			local y = startPos.Y.Offset + delta.Y
			-- clamp inside screen optionally
			frame.Position = UDim2.new(startPos.X.Scale, x, startPos.Y.Scale, y)
		end
	end)
end

-- =========================
-- // Rainbow stroke helper
-- =========================
local function rainbowStroke(uiStroke)
	coroutine.wrap(function()
		local hue = 0
		while uiStroke and uiStroke.Parent do
			uiStroke.Color = Color3.fromHSV(hue % 1, 1, 1)
			hue = hue + 0.007
			RunService.Heartbeat:Wait()
		end
	end)()
end

-- =========================
-- // Get current index from Player Attribute (persists on respawn)
-- =========================
local function getPlayerIndex()
	local idx = player:GetAttribute("APEXIndex")
	if type(idx) ~= "number" then
		idx = 1
		player:SetAttribute("APEXIndex", idx)
	end
	if idx < 1 then idx = 1 end
	if idx > MAX_INDEX then idx = MAX_INDEX end
	return idx
end

local function advancePlayerIndex()
	local idx = getPlayerIndex()
	if idx < MAX_INDEX then
		player:SetAttribute("APEXIndex", idx + 1)
	end
end

-- =========================
-- // Build GUI
-- =========================
-- Remove old if existing
local old = playerGui:FindFirstChild("APEX_HUB")
if old then old:Destroy() end

local gui = Instance.new("ScreenGui")
gui.Name = "APEX_HUB"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- small helper to create UICorner + stroke + gradient
local function beautify(frame)
	local corner = Instance.new("UICorner", frame)
	corner.CornerRadius = UDim.new(0,10)
	local stroke = Instance.new("UIStroke", frame)
	stroke.Thickness = 3
	stroke.Transparency = 0
	local grad = Instance.new("UIGradient", frame)
	grad.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(40,40,40)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(20,20,30))
	}
	return stroke
end

-- Top floating thank-you (auto remove)
local msg = Instance.new("TextLabel", gui)
msg.Size = UDim2.new(0.6,0,0.07,0)
msg.Position = UDim2.new(0.2,0,0.02,0)
msg.Text = "‚ú® C·∫£m ∆°n ƒë√£ s·ª≠ d·ª•ng APEX HUB ‚ú®"
msg.TextScaled = true
msg.Font = Enum.Font.GothamBold
msg.TextColor3 = Color3.new(1,1,1)
msg.BackgroundTransparency = 1
-- Remove after 4.5s
delay(4.5, function() if msg and msg.Parent then msg:Destroy() end end)

-- ===== Key Frame (hi·ªán ƒë·∫ßu ti√™n) =====
local keyFrame = Instance.new("Frame", gui)
keyFrame.Size = UDim2.new(0,420,0,230)
keyFrame.Position = UDim2.new(0.28,0,0.28,0)
keyFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
local keyStroke = beautify(keyFrame)
makeDraggable(keyFrame)
rainbowStroke(keyStroke)

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1,0,0.18,0)
keyTitle.Position = UDim2.new(0,0,0,8)
keyTitle.Text = "üîê NH·∫¨P KEY - APEX HUB"
keyTitle.TextScaled = true
keyTitle.Font = Enum.Font.GothamBold
keyTitle.TextColor3 = Color3.new(1,1,1)
keyTitle.BackgroundTransparency = 1

local keyHint = Instance.new("TextLabel", keyFrame)
keyHint.Size = UDim2.new(0.9,0,0.09,0)
keyHint.Position = UDim2.new(0.05,0,0.18,0)
keyHint.Text = "Key theo th·ª© t·ª±: APEXKEY1 ‚Üí APEXKEY2 ‚Üí ..."
keyHint.TextScaled = true
keyHint.Font = Enum.Font.Gotham
keyHint.TextColor3 = Color3.fromRGB(200,200,200)
keyHint.BackgroundTransparency = 1

local inputBox = Instance.new("TextBox", keyFrame)
inputBox.Size = UDim2.new(0.9,0,0.18,0)
inputBox.Position = UDim2.new(0.05,0,0.3,0)
inputBox.PlaceholderText = "Nh·∫≠p Key..."
inputBox.Text = ""
inputBox.TextScaled = true
inputBox.Font = Enum.Font.Gotham
inputBox.BackgroundColor3 = Color3.fromRGB(45,45,45)
inputBox.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", inputBox)

local confirmBtn = Instance.new("TextButton", keyFrame)
confirmBtn.Size = UDim2.new(0.42,0,0.16,0)
confirmBtn.Position = UDim2.new(0.05,0,0.55,0)
confirmBtn.Text = "‚úÖ X√°c nh·∫≠n"
confirmBtn.TextScaled = true
confirmBtn.Font = Enum.Font.GothamBold
confirmBtn.BackgroundColor3 = Color3.fromRGB(0,160,80)
confirmBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", confirmBtn)

local linkBtn = Instance.new("TextButton", keyFrame)
linkBtn.Size = UDim2.new(0.42,0,0.16,0)
linkBtn.Position = UDim2.new(0.53,0,0.55,0)
linkBtn.Text = "üåê L·∫•y Link"
linkBtn.TextScaled = true
linkBtn.Font = Enum.Font.GothamBold
linkBtn.BackgroundColor3 = Color3.fromRGB(0,120,200)
linkBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", linkBtn)

local feedback = Instance.new("TextLabel", keyFrame)
feedback.Size = UDim2.new(0.9,0,0.12,0)
feedback.Position = UDim2.new(0.05,0,0.74,0)
feedback.Text = ""
feedback.TextScaled = true
feedback.Font = Enum.Font.Gotham
feedback.TextColor3 = Color3.fromRGB(255,200,100)
feedback.BackgroundTransparency = 1

-- ===== Main Frame (·∫©n ban ƒë·∫ßu) =====
local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0,300,0,240)
mainFrame.Position = UDim2.new(0.05,0,0.28,0)
mainFrame.BackgroundColor3 = Color3.fromRGB(28,28,28)
mainFrame.Visible = false
local mainStroke = beautify(mainFrame)
makeDraggable(mainFrame)
rainbowStroke(mainStroke)

local mainTitle = Instance.new("TextLabel", mainFrame)
mainTitle.Size = UDim2.new(1,0,0.16,0)
mainTitle.Position = UDim2.new(0,0,0,8)
mainTitle.Text = "APEX HUB - MAIN"
mainTitle.TextScaled = true
mainTitle.Font = Enum.Font.GothamBold
mainTitle.TextColor3 = Color3.new(1,1,1)
mainTitle.BackgroundTransparency = 1

-- helper t·∫°o n√∫t trong main
local function createBtn(parent, text, y)
	local btn = Instance.new("TextButton", parent)
	btn.Size = UDim2.new(0.88,0,0.18,0)
	btn.Position = UDim2.new(0.06,0,y,0)
	btn.Text = text
	btn.TextScaled = true
	btn.Font = Enum.Font.GothamBold
	btn.BackgroundColor3 = Color3.fromRGB(160,60,60)
	btn.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", btn)
	return btn
end

local liftBtn = createBtn(mainFrame, "‚¨ÜÔ∏è N√¢ng OFF", 0.2)
local flyBtn = createBtn(mainFrame, "üü© ƒêi Tr√™n Kh√¥ng OFF", 0.42)
local openKeyBtn = createBtn(mainFrame, "üîë M·ªü l·∫°i GetKey", 0.64)

-- Toggle icon (lu√¥n hi·ªán ƒë·ªÉ show/·∫©n main)
local toggleBtn = Instance.new("ImageButton", gui)
toggleBtn.Size = UDim2.new(0,52,0,52)
toggleBtn.Position = UDim2.new(0.01,0,0.82,0)
toggleBtn.Image = ""
toggleBtn.BackgroundColor3 = Color3.fromRGB(45,45,45)
toggleBtn.AutoButtonColor = true
local tgCorner = Instance.new("UICorner", toggleBtn)
tgCorner.CornerRadius = UDim.new(0,8)
local tgLabel = Instance.new("TextLabel", toggleBtn)
tgLabel.Size = UDim2.new(1,0,1,0)
tgLabel.Text = "üìÇ"
tgLabel.TextScaled = true
tgLabel.BackgroundTransparency = 1
tgLabel.Font = Enum.Font.GothamBold
tgLabel.TextColor3 = Color3.new(1,1,1)
makeDraggable(toggleBtn)
-- toggle behavior
toggleBtn.MouseButton1Click:Connect(function()
	-- ch·ªâ cho hi·ªán main n·∫øu ƒë√£ unlock
	local idx = getPlayerIndex()
	if idx and idx > 1 or mainFrame.Visible then
		mainFrame.Visible = not mainFrame.Visible
	else
		-- ch∆∞a m·ªü key ‚Üí nh·∫Øc
		feedback.Text = "Vui l√≤ng nh·∫≠p KEY tr∆∞·ªõc khi m·ªü HUB"
		delay(2.2, function() if feedback then feedback.Text = "" end end)
	end
end)

-- =========================
-- // Logic: key + link
-- =========================
local function refreshKeyDisplay()
	local idx = getPlayerIndex()
	local key = KEYS[idx] or KEYS[#KEYS]
	local link = LINKS[idx] or LINKS[#LINKS]
	keyHint.Text = ("Key hi·ªán t·∫°i: %s  (index %d/%d)"):format(key, idx, MAX_INDEX)
	return key, link, idx
end

refreshKeyDisplay()

linkBtn.MouseButton1Click:Connect(function()
	local _, link = refreshKeyDisplay()
	local ok, err = pcall(function() setclipboard(link) end)
	if ok then
		feedback.Text = "ƒê√£ copy link v√†o clipboard!"
	else
		feedback.Text = "Kh√¥ng th·ªÉ copy. Link: "..tostring(link)
	end
	delay(2, function() feedback.Text = "" end)
end)

confirmBtn.MouseButton1Click:Connect(function()
	local typed = (inputBox.Text or ""):upper():gsub("%s+","")
	local key, link, idx = refreshKeyDisplay()
	if typed == key then
		-- success: advance index, m·ªü main, ·∫©n keyFrame
		advancePlayerIndex()
		-- show nice message
		feedback.Text = "‚úÖ ƒê√£ nh·∫≠n Key! M·ªü HUB..."
		-- tr√™n m·ªôt v√†i thi·∫øt b·ªã SetAttribute c√≥ delay, c·∫≠p nh·∫≠t local ngay
		inputBox.Text = ""
		delay(0.5, function()
			keyFrame.Visible = false
			mainFrame.Visible = true
		end)
		delay(2.5, function() feedback.Text = "" end)
	else
		-- wrong key
		inputBox.Text = ""
		feedback.Text = "‚ùå Sai Key ho·∫∑c ch∆∞a t·ªõi l∆∞·ª£t key n√†y."
		delay(2.2, function() if feedback then feedback.Text = "" end end)
	end
end)

-- n·∫øu ng∆∞·ªùi ch∆°i ƒë√£ unlock (index>1) th√¨ ·∫©n keyFrame
if getPlayerIndex() > 1 then
	keyFrame.Visible = false
	mainFrame.Visible = true
end

openKeyBtn.MouseButton1Click:Connect(function()
	keyFrame.Visible = true
	mainFrame.Visible = false
end)

-- =========================
-- // Lift logic (m∆∞·ª£t, speed ch·ªânh b·∫±ng liftSpeed)
-- =========================
local liftPart, liftConn
local function startLift()
	if liftPart then return end
	liftPart = Instance.new("Part")
	liftPart.Name = "APEX_LiftPart"
	liftPart.Size = Vector3.new(6,1,6)
	liftPart.Anchored = true
	liftPart.CanCollide = true
	liftPart.Color = Color3.fromRGB(70,200,80)
	liftPart.Transparency = 0.25
	liftPart.Parent = workspace
	-- smooth movement: we Lerp CFrame towards target each frame
	local yOffset = -3
	liftConn = RunService.RenderStepped:Connect(function(dt)
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			local hrp = char.HumanoidRootPart
			local targetPos = hrp.Position + Vector3.new(0, yOffset + liftSpeed * dt, 0)
			-- keep y slowly interpolated to give smooth up motion
			local current = liftPart.CFrame
			local aim = CFrame.new(Vector3.new(targetPos.X, targetPos.Y, targetPos.Z))
			liftPart.CFrame = current:lerp(aim, math.clamp(3*dt, 0, 1))
		end
	end)
end

local function stopLift()
	if liftConn then liftConn:Disconnect() liftConn = nil end
	if liftPart then liftPart:Destroy() liftPart = nil end
end

liftBtn.MouseButton1Click:Connect(function()
	if not liftPart then
		startLift()
		liftBtn.Text = "‚¨ÜÔ∏è N√¢ng ON"
		liftBtn.BackgroundColor3 = Color3.fromRGB(60,200,100)
	else
		stopLift()
		liftBtn.Text = "‚¨ÜÔ∏è N√¢ng OFF"
		liftBtn.BackgroundColor3 = Color3.fromRGB(180,60,60)
	end
end)

-- =========================
-- // Fly logic (m∆∞·ª£t, ch·∫≠m, kh√¥ng ngay d∆∞·ªõi lift)
-- =========================
local flyPart, flyConn
local flyBaseY = 2.6 -- base offset so it's not directly at feet (bigger = ph·∫ßn c√°ch xa h∆°n)
local flyPhase = 0
local function startFly()
	if flyPart then return end
	flyPart = Instance.new("Part")
	flyPart.Name = "APEX_FlyPart"
	flyPart.Size = Vector3.new(6,1,6)
	flyPart.Anchored = true
	flyPart.CanCollide = true
	flyPart.Color = Color3.fromRGB(210,200,70)
	flyPart.Transparency = 0.25
	flyPart.Parent = workspace

	flyConn = RunService.Heartbeat:Connect(function(dt)
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") then
			flyPhase = flyPhase + dt * flySpeed
			local hrp = char.HumanoidRootPart
			-- small sinusoidal offset: amplitude flyAmp, base flyBaseY above/below character
			local offsetY = math.sin(flyPhase * math.pi * 2) * flyAmp
			local targetPos = hrp.Position + Vector3.new(0, flyBaseY + offsetY, 0)
			local current = flyPart.CFrame
			local aim = CFrame.new(targetPos)
			-- lerp factor small for smooth slow motion
			flyPart.CFrame = current:lerp(aim, math.clamp(2.5 * dt, 0, 1))
		end
	end)
end

local function stopFly()
	if flyConn then flyConn:Disconnect() flyConn = nil end
	if flyPart then flyPart:Destroy() flyPart = nil end
end

flyBtn.MouseButton1Click:Connect(function()
	if not flyPart then
		startFly()
		flyBtn.Text = "üü© ƒêi Tr√™n Kh√¥ng ON"
		flyBtn.BackgroundColor3 = Color3.fromRGB(60,200,100)
	else
		stopFly()
		flyBtn.Text = "üü© ƒêi Tr√™n Kh√¥ng OFF"
		flyBtn.BackgroundColor3 = Color3.fromRGB(180,60,60)
	end
end)

-- Clean up on character removing (destroy parts)
player.CharacterRemoving:Connect(function()
	stopLift()
	stopFly()
end)

-- =========================
-- // Extra: show current config (b√™n trong main)
-- =========================
local configLabel = Instance.new("TextLabel", mainFrame)
configLabel.Size = UDim2.new(0.9,0,0.16,0)
configLabel.Position = UDim2.new(0.05,0,0.82,0)
configLabel.Text = ("LiftSpeed: %.1f ¬∑ FlySpeed: %.2f ¬∑ FlyAmp: %.2f"):format(liftSpeed, flySpeed, flyAmp)
configLabel.TextScaled = true
configLabel.Font = Enum.Font.Gotham
configLabel.TextColor3 = Color3.fromRGB(220,220,220)
configLabel.BackgroundTransparency = 1

-- =========================
-- // Done - th√¥ng tin cho b·∫°n
-- =========================
-- Ghi ch√∫:
-- - Ch·ªânh t·ªëc ƒë·ªô ·ªü ƒë·∫ßu script (liftSpeed, flySpeed, flyAmp)
-- - Key m·ªü theo th·ª© t·ª±: APEXKEY1 -> APEXKEY2 ... v√† t∆∞∆°ng ·ª©ng link trong LINKS
-- - Progress l∆∞u tr√™n Player attribute "APEXIndex" (kh√¥ng m·∫•t khi reset)
-- - C·∫£ 2 frame ƒë·ªÅu draggable (chu·ªôt + c·∫£m ·ª©ng)
-- - Vi·ªÅn c·∫ßu v·ªìng ch·∫°y b·∫±ng UIStroke
