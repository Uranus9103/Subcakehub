-- LocalScript trong StarterPlayerScripts hoáº·c StarterGui

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FlyBackSystem"
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local saveBtn = Instance.new("TextButton")
saveBtn.Size = UDim2.new(0, 150, 0, 50)
saveBtn.Position = UDim2.new(0, 50, 1, -120)
saveBtn.Text = "ğŸ“ LÆ°u vá»‹ trÃ­"
saveBtn.Parent = ScreenGui

local flyBtn = Instance.new("TextButton")
flyBtn.Size = UDim2.new(0, 150, 0, 50)
flyBtn.Position = UDim2.new(0, 220, 1, -120)
flyBtn.Text = "âœˆï¸ Bay vá»"
flyBtn.Parent = ScreenGui

-- Biáº¿n
local savedCFrame
local flying = false
local tween -- giá»¯ tween hiá»‡n táº¡i

-- LÆ°u vá»‹ trÃ­
saveBtn.MouseButton1Click:Connect(function()
    if hrp then
        savedCFrame = hrp.CFrame
        print("âœ… ÄÃ£ lÆ°u vá»‹ trÃ­ táº¡i:", savedCFrame.Position)
    end
end)

-- Anti cháº¿t
humanoid:GetPropertyChangedSignal("Health"):Connect(function()
    if flying then
        humanoid.Health = humanoid.MaxHealth
    end
end)

-- HÃ m bay mÆ°á»£t dÃ¹ng TweenService
local function flyTo(targetCFrame)
    if not hrp or not targetCFrame then return end

    -- TÃ­nh thá»i gian bay dá»±a trÃªn khoáº£ng cÃ¡ch
    local distance = (targetCFrame.Position - hrp.Position).Magnitude
    local flyTime = math.clamp(distance / 50, 0.5, 5) -- max 5 giÃ¢y

    -- Táº¡o tween
    local tweenInfo = TweenInfo.new(flyTime, Enum.EasingStyle.Linear)
    tween = TweenService:Create(hrp, tweenInfo, {CFrame = targetCFrame})
    tween:Play()

    -- Dá»«ng khi hoÃ n táº¥t
    tween.Completed:Connect(function()
        flying = false
    end)
end

-- KÃ­ch hoáº¡t bay
flyBtn.MouseButton1Click:Connect(function()
    if savedCFrame then
        flying = true
        flyTo(savedCFrame)
    else
        warn("âš ï¸ ChÆ°a lÆ°u vá»‹ trÃ­!")
    end
end)

-- Anti reset + anti vá» chá»— cÅ©
RunService.Stepped:Connect(function()
    if flying and savedCFrame and hrp then
        local distance = (hrp.Position - savedCFrame.Position).Magnitude
        if distance > 100 then -- náº¿u bá»‹ kÃ©o vá» quÃ¡ xa (spawn)
            print("ğŸš« Anti reset kÃ­ch hoáº¡t, Ä‘Æ°a láº¡i vá»‹ trÃ­ Ä‘Ã£ lÆ°u")
            hrp.CFrame = savedCFrame
        end
    end
end)
