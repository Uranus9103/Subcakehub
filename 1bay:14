--// FULL SCRIPT: Shield + Music + Aura + Fire GUI
-- ƒê·∫∑t script n√†y trong StarterPlayer > StarterPlayerScripts

-- SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local SoundService = game:GetService("SoundService")

local player = Players.LocalPlayer

-- RemoteEvent cho Shield
local remote = ReplicatedStorage:FindFirstChild("ShieldToggleEvent")
if not remote then
    remote = Instance.new("RemoteEvent")
    remote.Name = "ShieldToggleEvent"
    remote.Parent = ReplicatedStorage
end

-- SETTINGS Shield
local numParts = 6
local radius = 5
local rotationSpeed = 2
local checkRadius = 4
local damagePerHit = 25

-- TR·∫†NG TH√ÅI
local shieldActive = false
local orbitParts = {}
local auraActive = false
local auraPart = nil
local fireActive = false
local fireEffect = nil
local musicSound = nil

-- GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PowerMenu"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- B·∫£ng menu
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,200,0,250)
frame.Position = UDim2.new(1,-210,0,10) -- g√≥c ph·∫£i tr√™n
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.BackgroundTransparency = 0.3
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- UIList ƒë·ªÉ x·∫øp n√∫t d·ªçc
local list = Instance.new("UIListLayout")
list.Parent = frame
list.SortOrder = Enum.SortOrder.LayoutOrder
list.Padding = UDim.new(0,5)

-- T·∫°o n√∫t
local function createButton(text)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-10,0,40)
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Text = text
    btn.Parent = frame
    return btn
end

-- √î nh·∫≠p nh·∫°c
local musicBox = Instance.new("TextBox")
musicBox.Size = UDim2.new(1,-10,0,40)
musicBox.PlaceholderText = "Nh·∫≠p ID nh·∫°c..."
musicBox.Text = ""
musicBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
musicBox.TextColor3 = Color3.fromRGB(255,255,255)
musicBox.Font = Enum.Font.Gotham
musicBox.TextSize = 14
musicBox.Parent = frame

-- C√°c n√∫t
local shieldBtn = createButton("B·∫≠t L√° Ch·∫Øn")
local musicBtn = createButton("Ph√°t Nh·∫°c")
local auraBtn = createButton("B·∫≠t H√†o Quang")
local fireBtn = createButton("B·∫≠t L·ª≠a üî•")

-- H√ÄM T·∫†O SHIELD
local function createShieldParts()
    local parts = {}
    for i = 1, numParts do
        local part = Instance.new("Part")
        part.Size = Vector3.new(2,2,2)
        part.Shape = Enum.PartType.Ball
        part.Anchored = true
        part.CanCollide = false
        part.Material = Enum.Material.Neon
        part.Color = Color3.fromRGB(255,255,0)
        part.Transparency = 0.3
        part.Parent = workspace
        table.insert(parts, part)
    end
    return parts
end

-- H√ÄM T·∫†O H√ÄO QUANG
local function createAura()
    local part = Instance.new("Part")
    part.Size = Vector3.new(8,0.5,8)
    part.Shape = Enum.PartType.Cylinder
    part.Anchored = true
    part.CanCollide = false
    part.Material = Enum.Material.Neon
    part.Color = Color3.fromRGB(255, 223, 0) -- v√†ng s√°ng
    part.Transparency = 0.3
    part.Parent = workspace
    return part
end

-- B·∫¨T / T·∫ÆT SHIELD
shieldBtn.MouseButton1Click:Connect(function()
    shieldActive = not shieldActive
    shieldBtn.Text = shieldActive and "T·∫Øt L√° Ch·∫Øn" or "B·∫≠t L√° Ch·∫Øn"
    remote:FireServer(shieldActive)

    if shieldActive then
        orbitParts = createShieldParts()
    else
        for _,p in pairs(orbitParts) do p:Destroy() end
        orbitParts = {}
    end
end)

-- B·∫¨T / T·∫ÆT NH·∫†C
musicBtn.MouseButton1Click:Connect(function()
    if musicSound then
        musicSound:Stop()
        musicSound:Destroy()
        musicSound = nil
        musicBtn.Text = "Ph√°t Nh·∫°c"
        -- B·∫≠t l·∫°i √¢m game
        SoundService.RespectFilteringEnabled = true
    else
        if musicBox.Text ~= "" then
            local id = tonumber(musicBox.Text)
            if id then
                -- T·∫Øt √¢m g·ªëc game
                SoundService.RespectFilteringEnabled = false
                -- T·∫°o nh·∫°c ri√™ng
                musicSound = Instance.new("Sound")
                musicSound.SoundId = "rbxassetid://"..id
                musicSound.Looped = true
                musicSound.Volume = 5
                musicSound.Parent = workspace
                musicSound:Play()
                musicBtn.Text = "T·∫Øt Nh·∫°c"
            end
        end
    end
end)

-- B·∫¨T / T·∫ÆT H√ÄO QUANG
auraBtn.MouseButton1Click:Connect(function()
    auraActive = not auraActive
    auraBtn.Text = auraActive and "T·∫Øt H√†o Quang" or "B·∫≠t H√†o Quang"

    if auraActive then
        auraPart = createAura()
    else
        if auraPart then auraPart:Destroy() end
        auraPart = nil
    end
end)

-- B·∫¨T / T·∫ÆT L·ª¨A
fireBtn.MouseButton1Click:Connect(function()
    fireActive = not fireActive
    fireBtn.Text = fireActive and "T·∫Øt L·ª≠a üî•" or "B·∫≠t L·ª≠a üî•"

    if fireActive then
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            fireEffect = Instance.new("Fire")
            fireEffect.Size = 15
            fireEffect.Heat = 10
            fireEffect.Parent = player.Character.HumanoidRootPart
        end
    else
        if fireEffect then fireEffect:Destroy() end
        fireEffect = nil
    end
end)

-- C·∫¨P NH·∫¨T LI√äN T·ª§C
RunService.RenderStepped:Connect(function()
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- Shield xoay quanh
    if shieldActive then
        local time = tick() * rotationSpeed
        for i, part in ipairs(orbitParts) do
            local angle = time + (i * (2*math.pi/numParts))
            local x = hrp.Position.X + radius * math.cos(angle)
            local z = hrp.Position.Z + radius * math.sin(angle)
            part.Position = Vector3.new(x, hrp.Position.Y + 2, z)
        end
    end

    -- H√†o quang donut ph√≠a sau l∆∞ng
    if auraActive and auraPart then
        auraPart.CFrame = hrp.CFrame * CFrame.new(0,0,-3) * CFrame.Angles(0, tick()*2, 0)
    end
end)

-- SERVER DAMAGE
remote.OnServerEvent:Connect(function(plr, state)
    if state then
        local connection
        connection = RunService.Heartbeat:Connect(function()
            if not plr or not plr.Character or not plr.Character:FindFirstChild("HumanoidRootPart") then
                connection:Disconnect()
                return
            end
            local hrp = plr.Character.HumanoidRootPart
            local time = tick() * rotationSpeed
            for i = 1, numParts do
                local angle = time + (i * (2*math.pi/numParts))
                local x = hrp.Position.X + radius * math.cos(angle)
                local z = hrp.Position.Z + radius * math.sin(angle)
                local partPos = Vector3.new(x, hrp.Position.Y + 2, z)

                for _, other in pairs(Players:GetPlayers()) do
                    if other ~= plr and other.Character then
                        local hum = other.Character:FindFirstChild("Humanoid")
                        local ohrp = other.Character:FindFirstChild("HumanoidRootPart")
                        if hum and ohrp then
                            if (ohrp.Position - partPos).Magnitude < checkRadius then
                                hum.Health = 0
                            end
                        end
                    end
                end
            end
        end)
        plr:SetAttribute("ShieldConnection", connection)
    else
        local conn = plr:GetAttribute("ShieldConnection")
        if conn then conn:Disconnect() end
        plr:SetAttribute("ShieldConnection", nil)
    end
end)
