-- Orb System with Toggle + Push
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Cấu hình Orb
local ORB_COUNT = 6              -- số lượng orb quay quanh
local ORB_DISTANCE = 6           -- bán kính quay quanh
local ORB_SIZE = Vector3.new(2,2,2) -- kích thước orb
local PUSH_FORCE = 100           -- lực đẩy mạnh
local DETECT_RADIUS = 6          -- khoảng cách orb phát hiện người khác
local CHASE_SPEED = 30           -- tốc độ orb bay theo khi phát hiện

-- Trạng thái
local orbs = {}
local angle = 0
local enabled = false

-- GUI toggle
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "OrbGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 120, 0, 50)
toggleButton.Position = UDim2.new(1, -130, 1, -60)
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 200)
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20
toggleButton.Text = "Bật Orb"
toggleButton.Parent = screenGui
toggleButton.Draggable = true

-- Tạo orb
local function createOrb(index)
	local orb = Instance.new("Part")
	orb.Shape = Enum.PartType.Ball
	orb.Size = ORB_SIZE
	orb.Anchored = true
	orb.CanCollide = false
	orb.Color = Color3.fromRGB(100, 200, 255)
	orb.Material = Enum.Material.Neon
	orb.Name = "Orb_"..index
	orb.Parent = workspace
	orb.Transparency = 1
	table.insert(orbs, orb)
end

-- Hiển thị/ẩn orb
local function setOrbVisible(state)
	for _, orb in ipairs(orbs) do
		orb.Transparency = state and 0 or 1
	end
end

-- Tạo orb ban đầu
for i = 1, ORB_COUNT do
	createOrb(i)
end

-- Toggle
toggleButton.MouseButton1Click:Connect(function()
	enabled = not enabled
	toggleButton.Text = enabled and "Tắt Orb" or "Bật Orb"
	setOrbVisible(enabled)
end)

-- Update
RunService.RenderStepped:Connect(function(dt)
	if enabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local root = LocalPlayer.Character.HumanoidRootPart
		angle = angle + dt * 2 -- tốc độ quay quanh
		
		for i, orb in ipairs(orbs) do
			local targetPos = nil
			
			-- Tìm người chơi gần orb
			for _, plr in ipairs(Players:GetPlayers()) do
				if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					local hrp = plr.Character.HumanoidRootPart
					local dist = (hrp.Position - orb.Position).Magnitude
					
					if dist < DETECT_RADIUS then
						targetPos = hrp.Position
						
						-- Đẩy người chơi ra xa
						local dir = (hrp.Position - root.Position).Unit
						hrp.Velocity = dir * PUSH_FORCE
					end
				end
			end
			
			-- Nếu có target thì bay tới
			if targetPos then
				local newPos = orb.Position:Lerp(targetPos + Vector3.new(0,2,0), dt * (CHASE_SPEED/10))
				orb.Position = newPos
			else
				-- Không có ai gần thì quay quanh
				local offsetAngle = angle + (math.pi * 2 / ORB_COUNT) * i
				local x = math.cos(offsetAngle) * ORB_DISTANCE
				local z = math.sin(offsetAngle) * ORB_DISTANCE
				orb.Position = root.Position + Vector3.new(x, 2, z)
			end
		end
	end
end)
