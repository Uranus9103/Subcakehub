--// APEX HUB
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- DataStore local (ch·ªâ client, mock b·∫±ng set/get trong session)
local savedKey = nil

-- UI Drag Function
local function makeDraggable(frame, btn)
	btn = btn or frame
	local dragging, dragInput, dragStart, startPos
	local function update(input)
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
	btn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	btn.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
end

-- Rainbow Border
local function rainbowEffect(uiStroke)
	task.spawn(function()
		local hue = 0
		while task.wait(0.05) do
			hue = (hue + 1) % 360
			uiStroke.Color = Color3.fromHSV(hue/360, 1, 1)
		end
	end)
end

-- ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "APEX_HUB"
gui.ResetOnSpawn = false
gui.Parent = PlayerGui

-- Intro Text
local intro = Instance.new("TextLabel")
intro.Size = UDim2.new(1,0,0,60)
intro.Position = UDim2.new(0,0,0.1,0)
intro.Text = "‚ú® C·∫£m ∆°n ƒë√£ s·ª≠ d·ª•ng APEX HUB ‚ú®"
intro.TextScaled = true
intro.BackgroundTransparency = 1
intro.TextColor3 = Color3.fromRGB(255,255,0)
intro.Font = Enum.Font.GothamBold
intro.Parent = gui

task.delay(4, function()
	intro:Destroy()
end)

-- KEYS
local Keys = {
	"APEXKEY1","APEXKEY2","APEXKEY3","APEXKEY4","APEXKEY5","APEXKEY6",
	"APEXKEY7","APEXKEY8","APEXKEY9","APEXKEY10","APEXKEY11","APEXKEY12"
}
local Links = {
	"https://link1.com","https://link2.com","https://link3.com","https://link4.com",
	"https://link5.com","https://link6.com","https://link7.com","https://link8.com",
	"https://link9.com","https://link10.com","https://link11.com","https://link12.com"
}
local dayIndex = (math.floor(os.time() / 86400) % 12) + 1
local todayKey = Keys[dayIndex]
local todayLink = Links[dayIndex]

-- GetKey Frame
local keyFrame = Instance.new("Frame")
keyFrame.Size = UDim2.new(0,300,0,200)
keyFrame.Position = UDim2.new(0.3,0,0.3,0)
keyFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
keyFrame.Parent = gui
makeDraggable(keyFrame)

local stroke = Instance.new("UIStroke",keyFrame)
stroke.Thickness = 3
rainbowEffect(stroke)

local corner = Instance.new("UICorner",keyFrame)
corner.CornerRadius = UDim.new(0,10)

local keyBox = Instance.new("TextBox")
keyBox.Size = UDim2.new(0.8,0,0,40)
keyBox.Position = UDim2.new(0.1,0,0.2,0)
keyBox.PlaceholderText = "Nh·∫≠p Key..."
keyBox.Text = ""
keyBox.TextScaled = true
keyBox.Parent = keyFrame

local confirmBtn = Instance.new("TextButton")
confirmBtn.Size = UDim2.new(0.8,0,0,40)
confirmBtn.Position = UDim2.new(0.1,0,0.5,0)
confirmBtn.Text = "X√°c Nh·∫≠n"
confirmBtn.TextScaled = true
confirmBtn.Parent = keyFrame

local getBtn = Instance.new("TextButton")
getBtn.Size = UDim2.new(0.8,0,0,40)
getBtn.Position = UDim2.new(0.1,0,0.75,0)
getBtn.Text = "Get Key Link"
getBtn.TextScaled = true
getBtn.Parent = keyFrame

-- MAIN Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,200,0,200)
mainFrame.Position = UDim2.new(0.05,0,0.3,0)
mainFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
mainFrame.Visible = false
mainFrame.Parent = gui
makeDraggable(mainFrame)

local mStroke = Instance.new("UIStroke",mainFrame)
mStroke.Thickness = 3
rainbowEffect(mStroke)

local mCorner = Instance.new("UICorner",mainFrame)
mCorner.CornerRadius = UDim.new(0,10)

-- Buttons
local liftBtn = Instance.new("TextButton")
liftBtn.Size = UDim2.new(0.8,0,0,40)
liftBtn.Position = UDim2.new(0.1,0,0.2,0)
liftBtn.Text = "‚¨ÜÔ∏è N√¢ng OFF"
liftBtn.TextScaled = true
liftBtn.Parent = mainFrame

local flyBtn = Instance.new("TextButton")
flyBtn.Size = UDim2.new(0.8,0,0,40)
flyBtn.Position = UDim2.new(0.1,0,0.5,0)
flyBtn.Text = "ü™Ç ƒêi Tr√™n Kh√¥ng OFF"
flyBtn.TextScaled = true
flyBtn.Parent = mainFrame

-- Toggle Btn
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0,50,0,50)
toggleBtn.Position = UDim2.new(0,0,0.5,0)
toggleBtn.Text = "‚â°"
toggleBtn.TextScaled = true
toggleBtn.Parent = gui

-- LOGIC
local liftPart, flyPart, connection, flyConn
local liftEnabled, flyEnabled = false, false

-- Lift toggle
liftBtn.MouseButton1Click:Connect(function()
	liftEnabled = not liftEnabled
	if liftEnabled then
		if not liftPart then
			liftPart = Instance.new("Part")
			liftPart.Size = Vector3.new(6,1,6)
			liftPart.Anchored = true
			liftPart.Color = Color3.fromRGB(50,200,50)
			liftPart.Transparency = 0.2
			liftPart.Parent = workspace
		end
		connection = RunService.RenderStepped:Connect(function(dt)
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				local hrp = char.HumanoidRootPart
				liftPart.CFrame = hrp.CFrame - Vector3.new(0,3,0)
				liftPart.CFrame = liftPart.CFrame * CFrame.new(0,12*dt,0)
			end
		end)
		liftBtn.Text = "‚¨ÜÔ∏è N√¢ng ON"
	else
		if connection then connection:Disconnect() end
		if liftPart then liftPart:Destroy() liftPart=nil end
		liftBtn.Text = "‚¨ÜÔ∏è N√¢ng OFF"
	end
end)

-- Fly toggle
flyBtn.MouseButton1Click:Connect(function()
	flyEnabled = not flyEnabled
	if flyEnabled then
		if not flyPart then
			flyPart = Instance.new("Part")
			flyPart.Size = Vector3.new(6,1,6)
			flyPart.Anchored = true
			flyPart.Color = Color3.fromRGB(200,200,50)
			flyPart.Transparency = 0.3
			flyPart.Parent = workspace
		end
		local up = true
		flyConn = RunService.Heartbeat:Connect(function()
			local char = player.Character
			if char and char:FindFirstChild("HumanoidRootPart") then
				local hrp = char.HumanoidRootPart
				flyPart.CFrame = hrp.CFrame - Vector3.new(0,3,0)
				local offset = up and 1 or -1
				flyPart.CFrame = flyPart.CFrame * CFrame.new(0,offset,0)
			end
		end)
		-- ƒë·ªïi h∆∞·ªõng 1s/l·∫ßn
		task.spawn(function()
			while flyEnabled do
				up = not up
				task.wait(1)
			end
		end)
		flyBtn.Text = "ü™Ç ƒêi Tr√™n Kh√¥ng ON"
	else
		if flyConn then flyConn:Disconnect() end
		if flyPart then flyPart:Destroy() flyPart=nil end
		flyBtn.Text = "ü™Ç ƒêi Tr√™n Kh√¥ng OFF"
	end
end)

-- ToggleBtn logic
toggleBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
	keyFrame.Visible = not savedKey
end)

-- GetKey Logic
getBtn.MouseButton1Click:Connect(function()
	if setclipboard then
		setclipboard(todayLink)
	end
end)

confirmBtn.MouseButton1Click:Connect(function()
	if keyBox.Text == todayKey then
		savedKey = todayKey
		keyFrame.Visible = false
		mainFrame.Visible = true
	else
		keyBox.Text = "‚ùå Sai Key!"
	end
end)

-- N·∫øu ƒë√£ nh·∫≠p key th√¨ m·ªü main
if savedKey == todayKey then
	keyFrame.Visible = false
	mainFrame.Visible = true
end
