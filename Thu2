-- Jump Cao + AntiDie + AntiKick (test trong game của bạn)
-- Dán vào StarterPlayer > StarterPlayerScripts

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer

-- RemoteEvent cho AntiDie
local antiDieRE = ReplicatedStorage:FindFirstChild("AntiDieToggle")
if not antiDieRE then
	local newRE = Instance.new("RemoteEvent")
	newRE.Name = "AntiDieToggle"
	newRE.Parent = ReplicatedStorage
	antiDieRE = newRE

	-- Server xử lý AntiDie
	antiDieRE.OnServerEvent:Connect(function(plr, wantOn)
		local char = plr.Character
		if not char then return end
		local hum = char:FindFirstChildOfClass("Humanoid")
		if not hum then return end

		if wantOn then
			hum.BreakJointsOnDeath = false
			hum:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
			hum.HealthChanged:Connect(function(hp)
				if hp <= 0 then
					hum.Health = hum.MaxHealth
					hum:ChangeState(Enum.HumanoidStateType.Running)
				end
			end)
		else
			hum:SetStateEnabled(Enum.HumanoidStateType.Dead, true)
		end
	end)
end

-- ===== GUI =====
local gui = Instance.new("ScreenGui")
gui.Name = "JumpGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Name = "Panel"
frame.AnchorPoint = Vector2.new(1,0)
frame.Position = UDim2.new(1, -20, 0, 20)
frame.Size = UDim2.new(0, 220, 0, 170)
frame.BackgroundTransparency = 0.15
frame.Parent = gui

-- Cho phép kéo
do
	local dragging, dragStart, startPos
	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
		end
	end)
	frame.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false
		end
	end)
end

local function makeButton(text, y)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -20, 0, 36)
	btn.Position = UDim2.new(0, 10, 0, y)
	btn.Text = text
	btn.AutoButtonColor = true
	btn.Parent = frame
	return btn
end

-- Trạng thái
local jumpBoostOn = false
local antiDieOn = false
local antiKickOn = false

local btnJump = makeButton("Nhảy cao: OFF", 8)
local btnAntiDie = makeButton("Anti die: OFF", 46)
local btnAntiKick = makeButton("Anti kick: OFF", 84)

-- Nhảy cao
btnJump.MouseButton1Click:Connect(function()
	jumpBoostOn = not jumpBoostOn
	btnJump.Text = jumpBoostOn and "Nhảy cao: ON" or "Nhảy cao: OFF"
	local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
	if hum then
		hum.UseJumpPower = true
		hum.JumpPower = jumpBoostOn and 150 or 50
	end
end)

-- Anti die
btnAntiDie.MouseButton1Click:Connect(function()
	antiDieOn = not antiDieOn
	btnAntiDie.Text = antiDieOn and "Anti die: ON" or "Anti die: OFF"
	antiDieRE:FireServer(antiDieOn)
end)

-- Anti kick (client test)
btnAntiKick.MouseButton1Click:Connect(function()
	antiKickOn = not antiKickOn
	btnAntiKick.Text = antiKickOn and "Anti kick: ON" or "Anti kick: OFF"

	if antiKickOn then
		-- hook Kick
		local mt = getrawmetatable(game)
		setreadonly(mt, false)
		local oldNamecall = mt.__namecall
		mt.__namecall = function(self, ...)
			local method = getnamecallmethod()
			if tostring(method) == "Kick" and self == player then
				warn("Đã chặn Kick thử nghiệm!")
				return nil
			end
			return oldNamecall(self, ...)
		end
	end
end)

-- Giữ trạng thái khi respawn
player.CharacterAdded:Connect(function(char)
	if jumpBoostOn then
		local hum = char:WaitForChild("Humanoid")
		hum.UseJumpPower = true
		hum.JumpPower = 150
	end
	if antiDieOn then
		antiDieRE:FireServer(true)
	end
end)
