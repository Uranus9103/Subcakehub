local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local RS = game:GetService("RunService")

-- Tạo GUI
local gui = Instance.new("ScreenGui")
gui.Parent = player:WaitForChild("PlayerGui")
gui.Name = "FlyGUI"

local function createButton(text, pos, size, color)
	local btn = Instance.new("TextButton")
	btn.Text = text
	btn.Size = UDim2.new(0, size.X, 0, size.Y)
	btn.Position = UDim2.new(0, pos.X, 0, pos.Y)
	btn.BackgroundColor3 = color
	btn.TextScaled = true
	btn.Parent = gui
	return btn
end

-- Nút FLY
local toggleBtn = createButton("FLY", Vector2.new(10, 50), Vector2.new(100, 50), Color3.fromRGB(255, 182, 193))

-- Cơ chế bay
local flying = false
local speed = 50

local bodyGyro = Instance.new("BodyGyro")
bodyGyro.P = 9e4
bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)

local bodyVel = Instance.new("BodyVelocity")
bodyVel.MaxForce = Vector3.new(9e9, 9e9, 9e9)

-- Ẩn nhân vật
local function setCharacterTransparency(char, alpha)
	for _, v in pairs(char:GetDescendants()) do
		if v:IsA("BasePart") or v:IsA("Decal") then
			v.Transparency = alpha
		end
	end
end

-- Bắt đầu bay
local function startFly()
	local char = player.Character
	if not char or not char:FindFirstChild("HumanoidRootPart") then return end
	bodyGyro.Parent = char.HumanoidRootPart
	bodyVel.Parent = char.HumanoidRootPart
	setCharacterTransparency(char, 1) -- Tàng hình
	flying = true
end

-- Dừng bay
local function stopFly()
	local char = player.Character
	if not char then return end
	bodyGyro.Parent = nil
	bodyVel.Parent = nil
	setCharacterTransparency(char, 0) -- Hiện lại
	flying = false
end

-- Nút sự kiện
toggleBtn.MouseButton1Click:Connect(function()
	if flying then
		stopFly()
		toggleBtn.Text = "FLY"
	else
		startFly()
		toggleBtn.Text = "STOP"
	end
end)

-- Vòng lặp bay (dùng di chuyển mặc định của Roblox)
RS.RenderStepped:Connect(function()
	if flying then
		local char = player.Character
		if char and char:FindFirstChild("HumanoidRootPart") and char:FindFirstChildOfClass("Humanoid") then
			local moveDir = char:FindFirstChildOfClass("Humanoid").MoveDirection
			bodyGyro.CFrame = camera.CFrame
			bodyVel.Velocity = moveDir * speed
		end
	end
end)
